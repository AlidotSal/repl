!function(){"use strict";const e=["rollup","acorn","astring","csstree","cjs2es"];function n(e){return void 0!==self[e]}function r(e){if(!n(e))throw new Error("[REPL]: Dependency not initialized: "+e)}function t(e){if(e=e||"latest",n("malina")){if(malina.version===e)return;delete self.malina}try{importScripts(`modules/malinajs/${e}/malina.js`)}catch(n){throw new Error("[REPL]: Can't load MalinaJS v."+e)}r("malina")}async function a(e,n,t){r("malina");let a={exportDefault:!0,inlineTemplate:!0,autoSubscribe:!0,name:n,injectRuntime:t?null:"$runtime.configure({onerror: (e) => {window.malina_onerror && malina_onerror(e)}})"};try{const n=await malina.compile(e,a);return t?await async function(e){r("rollup");let n=await rollup.rollup({input:"./app.js",external:()=>!0,plugins:[{name:"plugin",resolveId:async e=>e,load:async n=>"./app.js"===n?e:""}],onwarn:()=>{}});return function(e){e=e.replace(/ import\(/g," import_dynamic("),console.log(e);let n=acorn.parse(e,{sourceType:"module"});return e=(e=astring.generate(n)).replace(/ import_dynamic\(/g," import(")}((await n.generate({format:"es"})).output[0].code)}(n):n}catch(e){throw console.error(e),new Error(`[MalinaJS] Compile error: ${e.message}: ${e.details}`)}}function o(){const e=/^\.{1,2}\//,n=/^https?:\/\/|^\/\//,r=/^malinajs\//;return{name:"rollup_plugin_module_resolver",async resolveId(t,a){return!e.test(t)||a&&!e.test(a)?e.test(t)&&n.test(a)?new URL(t,(o=a,"/"===o.slice(-1)||/\.[a-z0-9]+$/.test(o)?o:o+"/")).href:"@malinajs"==t?`modules/malinajs/${malina?malina.version:"latest"}/runtime.js`:r.test(t)?`modules/malinajs/${malina?malina.version:"latest"}/${t.slice(9)}`:await async function(e){try{let n=await s(e);if(!n.ok)throw new Error("Can't find module "+e);return e=n.url}catch(e){throw new Error("[Bundler] "+e.message)}}("https://unpkg.com/"+t):t;var o}}}function l(e){return{name:"rollup_plugin_files",async load(n){if(!n.startsWith("./"))return null;n=n.replace(/^\.\//,"");const r=e.find(e=>e.name===n);if(void 0===r)throw new Error(`[Bundler]: File ./${n} does not exist.`);return r.body}}}const i={};async function s(e){if(!i[e]){const n=await fetch(e);if(!n.ok)throw new Error("[Bundler] Can't download module from "+e);i[e]={url:n.url,ok:n.ok,status:n.status,body:n.ok?await n.text():""}}return i[e]}const{on:c,emit:u}=function(e){e=e||self;const n=[];return e.addEventListener("message",({data:e})=>{n.filter(n=>n.event===e.event).forEach(n=>n.handler(e.details))}),{on:(e,r)=>{n.push({event:e,handler:r})},off:(e,r)=>{n.filter(n=>n.event!==e&&n.handler!==r)},emit:(n,r)=>{e.postMessage({event:n,details:r})}}}();let m=!1;try{c("init",n=>{u("init"),m=!1,function(){for(let n of e)importScripts(`modules/${n}.js`),r(n);self["css-tree"]=self.csstree}(),t(n&&n.malinaVersion||"latest"),m=!0,u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION}),u("malinaVersion",malina.version)}),c("bundle",async e=>{try{const n=await async function(e){try{r("rollup");let n=await rollup.rollup({input:"./App.xht",external:!1,inlineDynamicImports:!0,treeshake:!1,plugins:[o(),l(e),{name:"rollup_plugin_download",async load(e){if(!/^https?:\/\//.test(e)&&!e.startsWith("modules/malinajs"))return null;try{const n=await s(e);return cjs2es.cjs2es(n.body)}catch(n){throw new Error(`[Bundler]: Unable download file ${e}.`)}}},{name:"rollup_plugin_malina",async transform(e,n){const r=n.match(/([^/]+).(html|ma|xht)$/);return r?{code:await a(e,r[1])}:null}}]});return(await n.generate({format:"iife",name:"Component",exports:"named",sourcemap:!1})).output[0].code}catch(e){throw e}}(e);u("bundle",n)}catch(e){console.error(e),u("error",e.message),u("bundle","")}}),c("compile",async e=>{try{const n=await a(e.code,e.name,!0);u("compile",n)}catch(e){console.error(e),u("error",e.message),u("compile","")}}),c("malinaVersion",async e=>{t(e),u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION})})}catch(e){console.error(e),u("error",e.message)}}();

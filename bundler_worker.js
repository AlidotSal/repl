!function(){"use strict";const e=["rollup","acorn","astring","csstree","cjs2es"];function n(e){return void 0!==self[e]}function r(e){if(!n(e))throw new Error("[REPL]: Dependency not initialized: "+e)}function t(e){if(e=e||"latest",n("malina")){if(malina.version===e)return;delete self.malina}try{importScripts(`modules/malinajs/${e}/malina.js`)}catch(n){throw new Error("[REPL]: Can't load MalinaJS v."+e)}r("malina")}async function a(e,n,t){r("malina");let a={exportDefault:!0,inlineTemplate:!0,autoSubscribe:!0,name:n};try{const n=await malina.compile(e,a);return t?await async function(e){r("rollup");let n=await rollup.rollup({input:"./made_by_AlexxNB.js",external:()=>!0,plugins:[{name:"plugin",resolveId:async e=>e,load:async n=>"./made_by_AlexxNB.js"===n?e:""}],onwarn:()=>{}});const t=(await n.generate({format:"es"})).output[0].code;return astring.generate(acorn.parse(t,{sourceType:"module"}))}(n):n}catch(e){throw console.error(e),new Error(`[MalinaJS] Compile error: ${e.message}: ${e.details}`)}}async function o(e){try{r("rollup"),e=[{name:"_entry.js",body:"import App from './App.xht';"},...e],malina.version.startsWith("0.5.")&&malina.version<"0.5.15"||(e[0].body+="\n                import { configure } from 'malinajs/runtime.js';\n                configure({\n                    onerror: e => {window.malina_onerror && malina_onerror(e);}\n                });\n            ");let n=await rollup.rollup({input:"./_entry.js",external:!1,inlineDynamicImports:!0,treeshake:!1,plugins:[{name:"rollup_plugin_module_resolver",async resolveId(e,n){return!e.startsWith("./")||n&&!n.startsWith("./")?e.startsWith("./")&&/^https?:\/\//.test(n)?new URL(e,(r=n,"/"===r.slice(-1)||/\.[a-z0-9]+$/.test(r)?r:r+"/")).href:e.startsWith("malinajs/")?`modules/malinajs/${malina?malina.version:"latest"}/${e.slice(9)}`:await async function(e){try{let n=await i(e);if(!n.ok)throw new Error("Can't find module "+e);return e=n.url}catch(e){throw new Error("[Bundler] "+e.message)}}("https://unpkg.com/"+e):e;var r}},s(e),{name:"rollup_plugin_download",async load(e){if(!/^https?:\/\//.test(e)&&!e.startsWith("modules/malinajs"))return null;try{const n=await i(e);return cjs2es.cjs2es(n.body)}catch(n){throw new Error(`[Bundler]: Unable download file ${e}.`)}}},{name:"rollup_plugin_malina",async transform(e,n){const r=n.match(/([^/]+).(html|ma|xht)$/);return r?{code:await a(e,r[1])}:null}}]});return(await n.generate({format:"cjs",name:"Component",exports:"named",sourcemap:!1})).output[0].code}catch(e){throw e}}function s(e){return{name:"rollup_plugin_files",async load(n){if(!n.startsWith("./"))return null;n=n.replace(/^\.\//,"");const r=e.find(e=>e.name===n);if(void 0===r)throw new Error(`[Bundler]: File ./${n} does not exist.`);return r.body}}}const l={};async function i(e){if(!l[e]){const n=await fetch(e);if(!n.ok)throw new Error("[Bundler] Can't download module from "+e);l[e]={url:n.url,ok:n.ok,status:n.status,body:n.ok?await n.text():""}}return l[e]}const{on:c,emit:u}=function(e){e=e||self;const n=[];return e.addEventListener("message",({data:e})=>{n.filter(n=>n.event===e.event).forEach(n=>n.handler(e.details))}),{on:(e,r)=>{n.push({event:e,handler:r})},off:(e,r)=>{n.filter(n=>n.event!==e&&n.handler!==r)},emit:(n,r)=>{e.postMessage({event:n,details:r})}}}();let m=!1;try{c("init",n=>{u("init"),m=!1,function(){for(let n of e)importScripts(`modules/${n}.js`),r(n);self["css-tree"]=self.csstree}(),t(n&&n.malinaVersion||"latest"),m=!0,u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION}),u("malinaVersion",malina.version)}),c("bundle",async e=>{try{const n=await o(e);u("bundle",n)}catch(e){console.error(e),u("error",e.message),u("bundle","")}}),c("compile",async e=>{try{const n=await a(e.code,e.name,!0);u("compile",n)}catch(e){console.error(e),u("error",e.message),u("compile","")}}),c("malinaVersion",async e=>{t(e),u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION})})}catch(e){console.error(e),u("error",e.message)}}();

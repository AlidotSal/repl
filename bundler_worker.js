!function(){"use strict";const e=["rollup","acorn","astring","csstree","cjs2es"];function n(e){return void 0!==self[e]}function t(e){if(!n(e))throw new Error("[REPL]: Dependency not initialized: "+e)}function r(e){if(e=e||"latest",n("malina")){if(malina.version===e)return;delete self.malina}try{importScripts(`modules/malinajs/${e}/malina.js`)}catch(n){throw new Error("[REPL]: Can't load MalinaJS v."+e)}t("malina")}async function a(e,n,r){t("malina");let a={exportDefault:!0,inlineTemplate:!0,name:n};try{const n=await malina.compile(e,a);return r?await async function(e){t("rollup");let n=await rollup.rollup({input:"./made_by_AlexxNB.js",external:()=>!0,plugins:[{name:"plugin",resolveId:async e=>e,load:async n=>"./made_by_AlexxNB.js"===n?e:""}],onwarn:()=>{}});const r=(await n.generate({format:"es"})).output[0].code;return astring.generate(acorn.parse(r,{sourceType:"module"}))}(n):n}catch(e){throw console.error(e),new Error(`[MalinaJS] Compile error: ${e.message}: ${e.details}`)}}async function o(e){try{t("rollup");let n=await rollup.rollup({input:"./App.ma",external:!1,inlineDynamicImports:!0,treeshake:!1,plugins:[{name:"rollup_plugin_module_resolver",async resolveId(e,n){return!e.startsWith("./")||n&&!n.startsWith("./")?e.startsWith("./")&&/^https?:\/\//.test(n)?new URL(e,(t=n,"/"===t.slice(-1)||/\.[a-z0-9]+$/.test(t)?t:t+"/")).href:e.startsWith("malinajs/")?`modules/malinajs/${malina?malina.version:"latest"}/${e.slice(9)}`:await async function(e){try{let n=await i(e);if(!n.ok)throw new Error("Can't find module "+e);return e=n.url}catch(e){throw new Error("[Bundler] "+e.message)}}("https://unpkg.com/"+e):e;var t}},l(e),{name:"rollup_plugin_download",async load(e){if(!/^https?:\/\//.test(e)&&!e.startsWith("modules/malinajs"))return null;try{const n=await i(e);return cjs2es.cjs2es(n.body)}catch(n){throw new Error(`[Bundler]: Unable download file ${e}.`)}}},{name:"rollup_plugin_malina",async transform(e,n){const t=n.match(/([^/]+).(html|ma)$/);return t?{code:await a(e,t[1])}:null}}]});return(await n.generate({format:"iife",name:"Component",exports:"named",sourcemap:!1})).output[0].code}catch(e){throw e}}function l(e){return{name:"rollup_plugin_files",async load(n){if(!n.startsWith("./"))return null;n=n.replace(/^\.\//,"");const t=e.find(e=>e.name===n);if(void 0===t)throw new Error(`[Bundler]: File ./${n} does not exist.`);return t.body}}}const s={};async function i(e){if(!s[e]){const n=await fetch(e);if(!n.ok)throw new Error("[Bundler] Can't download module from "+e);s[e]={url:n.url,ok:n.ok,status:n.status,body:n.ok?await n.text():""}}return s[e]}const{on:c,emit:u}=function(e){e=e||self;const n=[];return e.addEventListener("message",({data:e})=>{n.filter(n=>n.event===e.event).forEach(n=>n.handler(e.details))}),{on:(e,t)=>{n.push({event:e,handler:t})},off:(e,t)=>{n.filter(n=>n.event!==e&&n.handler!==t)},emit:(n,t)=>{e.postMessage({event:n,details:t})}}}();let m=!1;try{c("init",n=>{u("init"),m=!1,function(){for(let n of e)importScripts(`modules/${n}.js`),t(n);self["css-tree"]=self.csstree}(),r(n&&n.malinaVersion||"latest"),m=!0,u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION}),u("malinaVersion",malina.version)}),c("bundle",async e=>{try{const n=await o(e);u("bundle",n)}catch(e){console.error(e),u("error",e.message),u("bundle","")}}),c("compile",async e=>{try{const n=await a(e.code,e.name,!0);u("compile",n)}catch(e){console.error(e),u("error",e.message),u("compile","")}}),c("malinaVersion",async e=>{r(e),u("ready",{malinaVersion:malina.version,rollupVersion:rollup.VERSION})})}catch(e){console.error(e),u("error",e.message)}}();
